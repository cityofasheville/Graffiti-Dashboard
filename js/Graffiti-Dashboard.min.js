/*! Graffiti-Dashboard 2014-08-01 */
"use strict";var graffitiAvl=angular.module("graffitiAvl",["ngRoute"]).config(["$routeProvider","$locationProvider",function(a){a.when("/",{templateUrl:"html-templates/main.html",controller:"MainCtrl"}).otherwise({redirectTo:"/"})}]);angular.module("graffitiAvl").controller("MainCtrl",["$scope","$filter","pubStuffFact","geoJsonFact",function(b,c,d,e){L.Icon.Default.imagePath="dependencies/js/images",$("#loadingModal").modal();var f,g=(L.icon({iconUrl:"images/open.png",iconSize:[32,37],iconAnchor:[16,37],popupAnchor:[0,-28]}),L.icon({iconUrl:"images/completed.png",iconSize:[32,37],iconAnchor:[16,37],popupAnchor:[0,-28]}),L.tileLayer("http://{s}.mqcdn.com/tiles/1.0.0/map/{z}/{x}/{y}.png",{attribution:'&copy; <a href="http://osm.org/copyright" title="OpenStreetMap" target="_blank">OpenStreetMap</a> contributors | Tiles Courtesy of <a href="http://www.mapquest.com/" title="MapQuest" target="_blank">MapQuest</a> <img src="http://developer.mapquest.com/content/osm/mq_logo.png" width="16" height="16">',subdomains:["otile1","otile2","otile3","otile4"]})),h=L.tileLayer("http://{s}.mqcdn.com/tiles/1.0.0/sat/{z}/{x}/{y}.png",{attribution:'&copy; <a href="http://osm.org/copyright" title="OpenStreetMap" target="_blank">OpenStreetMap</a> contributors | Tiles Courtesy of <a href="http://www.mapquest.com/" title="MapQuest" target="_blank">MapQuest</a> <img src="http://developer.mapquest.com/content/osm/mq_logo.png" width="16" height="16">',subdomains:["otile1","otile2","otile3","otile4"]}),i={Aerial:h,OSM:g},j=L.map("map",{center:[35.5951125,-82.5511088],zoom:13,layers:[h,g]});L.control.layers(i).addTo(j);{var k=L.tileLayer("http://{s}.mqcdn.com/tiles/1.0.0/map/{z}/{x}/{y}.png",{attribution:'&copy; <a href="http://osm.org/copyright" title="OpenStreetMap" target="_blank">OpenStreetMap</a> contributors | Tiles Courtesy of <a href="http://www.mapquest.com/" title="MapQuest" target="_blank">MapQuest</a> <img src="http://developer.mapquest.com/content/osm/mq_logo.png" width="16" height="16">',subdomains:["otile1","otile2","otile3","otile4"]}),l=L.tileLayer("http://{s}.mqcdn.com/tiles/1.0.0/sat/{z}/{x}/{y}.png",{attribution:'&copy; <a href="http://osm.org/copyright" title="OpenStreetMap" target="_blank">OpenStreetMap</a> contributors | Tiles Courtesy of <a href="http://www.mapquest.com/" title="MapQuest" target="_blank">MapQuest</a> <img src="http://developer.mapquest.com/content/osm/mq_logo.png" width="16" height="16">',subdomains:["otile1","otile2","otile3","otile4"]}),m={Aerial:l,OSM:k},n=L.map("detailMap",{center:[35.5951125,-82.5511088],zoom:14,layers:[l,k]});L.control.layers(m).addTo(n)}b.map=!1,b.toggleDetailMap=function(){b.map=!b.map,b.map?(n.invalidateSize(),setTimeout(function(){n.invalidateSize()},500)):n.removeLayer(f)};b.getRequestDetails=function(a){n.setView([a.lat,a.lon],15),f=L.marker([a.lat,a.lon]).addTo(n),b.requestDetails={},b.requestDetails.requestDate=a.date_created,b.requestDetails.imageThumbnail=a.image_thumbnail,b.requestDetails.id=a.id,b.requestDetails.status=a.status,b.requestDetails.address=a.address,b.requestDetails.description=a.description,b.requestDetails.investmentByCity=0,b.requestDetails.costToPropertyOwner=0;for(var c=0;c<a.custom_fields.length;c++)"Investment by City ($):"===a.custom_fields[c].custom_field.name&&(b.requestDetails.investmentByCity=Number(a.custom_fields[c].custom_field.value)),"Cost to Property Owner ($):"===a.custom_fields[c].custom_field.name&&(b.requestDetails.costToPropertyOwner=Number(a.custom_fields[c].custom_field.value));$("#requestDetailsModal").modal()},b.closeRequestDetail=function(){b.map=!1,n.removeLayer(f)},b.posting=!1,b.postComment=function(e){b.comment="",b.posting=!1,d.postAComment(e,commment).then(function(){d.getCommentsForARequest(re).then(function(d){b.comments=c("orderBy")(d.comments,"-comment.create_date",!1),a.posting=!1})})}}]),graffitiAvl.factory("geoJsonFact",["$http","$q",function(){var a={};return a.generateGeoJsonFromRequestList=function(a){for(var b={type:"FeatureCollection",features:[]},c=0;c<a.length;c++){var d={type:"Feature",geometry:{type:"Point",coordinates:[a[c].request.lon,a[c].request.lat]},properties:a[c].request};b.features.push(d)}return b},a}]),graffitiAvl.factory("pubStuffFact",["$http","$q",function(a,b){var c={},d=819,e="58j013k159vpqz87xd85df0uy7epvl";return c.getListOfRequestTypes=function(){var c=b.defer(),f={return_type:"json",client_id:d,api_key:e};return a({url:"https://www.publicstuff.com/api/2.0/requesttypes_list?",method:"GET",params:f}).success(function(a){"error"===a.response.status.type&&console.log(a.response.status.message),c.resolve(a.response.request_types)}).error(function(a){console.log(a)}),c.promise},c.getListOfRequests=function(c){var d=b.defer();return c.return_type="json",c.status="all",c.api_key="i952rk495itu254sx21141j2d3je3x",a({url:"https://www.publicstuff.com/api/2.0/requests_list?",method:"GET",params:c}).success(function(a){"error"===a.response.status.type&&console.log(a.response.status.message),d.resolve(a.response)}).error(function(a){console.log(a)}),d.promise},c.getRequestDetails=function(c){var d=b.defer(),e={};return e.return_type="json",e.request_id=c,e.verbose=1,e.api_key="i952rk495itu254sx21141j2d3je3x",a({url:"https://www.publicstuff.com/api/2.0/request_view?",method:"GET",params:e}).success(function(a){"error"===a.response.status.type&&console.log(a.response.status.message),d.resolve(a.response)}).error(function(a){console.log(a)}),d.promise},c.getCommentsForARequest=function(c){var d=b.defer();return c.return_type="json",a({url:"https://www.publicstuff.com/api/2.0/requests_list?",method:"GET",params:c}).success(function(a){"error"===a.response.status.type&&console.log(a.response.status.message),d.resolve(a.response)}).error(function(a){console.log(a)}),d.promise},c.postAComment=function(c,d){var e=b.defer();return params.return_type="json",a({url:"https://www.publicstuff.com/api/2.0/requests_list?api_key=&request_id="+c+"&comment="+d,method:"POST",data:{}}).success(function(a){"error"===a.response.status.type&&console.log(a.response.status.message),e.resolve(a.response)}).error(function(a){console.log(a)}),e.promise},c}]);